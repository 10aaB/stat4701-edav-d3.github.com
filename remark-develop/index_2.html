<!DOCTYPE html>
<html>
  <head>
    <title>Stephen and Danny's D3 Mapping Presentation</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <style type="text/css">
      @import url(http://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
      @import url(http://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic);
      @import url(http://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

      body { 
        font-family: 'Droid Serif'; 
      }
      h1, h2, h3 {
        font-family: 'Yanone Kaffeesatz';
        font-weight: 400;
        margin-bottom: 0;
      }
      .remark-slide-content h1 { font-size: 3em; }
      .remark-slide-content h2 { font-size: 2em; }
      .remark-slide-content h3 { font-size: 1.6em; }
      .remark-code, .remark-inline-code { font-family: 'Ubuntu Mono'; }
      .remark-code-line-highlighted     { background-color: #373832; }
      /* Slide-specific styling */
      #slide-inverse .footnote {
        bottom: 12px;
        left: 20px;
      }
      #slide-how .slides {
        background: #333333;
        font-size: 0.9em;
        position: absolute;
        top:  151px;
        right: 140px;
        background-color: #333333;
      }
      #slide-how .slides h3 {
        margin-top: 0.2em;
      }
      #slide-how .slides .first, #slide-how .slides .second {
        padding: 1px 20px;
        height: 90px;
        width: 120px;
        -moz-box-shadow: 0 0 10px #777;
        -webkit-box-shadow: 0 0 10px #777;
        box-shadow: 0 0 10px #777;
      }
      #slide-how .slides .first {
        background: #333333;
        background-color: #333333;
        position: absolute;
        top: 20%;
        left: 20%;
        z-index: 1;
      }
      #slide-how .slides .second {
        position: relative;
        background: #fff;
        z-index: 0;
      }
      .inverse {
        background: #272822;
        color: #777872;
        text-shadow: 0 0 20px #333;
      }
      .inverse h1, .inverse h2 {
        color: #f3f3f3;
        line-height: 0.8em;
      }


      /* Two-column layout */
      .left-column {
        color: #777;
        width: 20%;
        height: 92%;
        float: left;
      }
        .left-column h2:last-of-type, .left-column h3:last-child {
          color: #000;
        }
      .right-column {
        width: 75%;
        float: right;
        padding-top: 1em;
      }
    </style>
  </head>
  <body>
    <textarea id="source">

class: center, middle
name: how
layout: false
background-image: url(https://raw.githubusercontent.com/stat4701-edav-d3/stat4701-edav-d3.github.com/master/remark-develop/img/googlemap.jpg)

# Stephen and Danny's D3 Mapping Presentation:
![googlemap](https://raw.githubusercontent.com/stat4701-edav-d3/stat4701-edav-d3.github.com/master/remark-develop/img/googlemap.jpg)   
## A <i>Crash Course</i> from Shapefile to TopoJSON (and some GeoJSON) using GDAL/OGR

---

.left-column[
  #Agenda
]

.right-column[
  ## Introduction
  ## Getting a Shapefile
  ## Conversion
  ## Plotting the JSON in D3
  ## TopoJSON vs. GeoJSON
  ## Demo: Choropleth
  ## Demo: Interactive Map (Tom Noda)
  ## Demo: Google Flu Data Map
]
---

.left-column[
  # Introduction
]

.right-column[

* ##About Us
  * ####Stephen
  * ####Danny

* ##Familiarity with JavaScript and D3? 

</br>

* ##Why we picked this topic? 
  * ####Get more familiar with JavaScript and D3

* ##What to expect? 
  * Some maps
  * Some live D3 demos
  * and... 


    some code


]


---


  # Getting a Shapefile

  ## Downloading the Shapefile
  ####[From the United States Census Bureau](https://www.census.gov/geo/maps-data/data/tiger-line.html)
  ```js
  import urllib

  zipLoc = "/data/cb_2013_us_state_20m.zip"
  fileURL = "http://www2.census.gov/geo/tiger/GENZ2013/cb_2013_us_state_20m.zip"
  urllib.urlretrieve (fileURL, zipLoc) #get that file

  import zipfile  
  
  zip = zipfile.ZipFile(zipLoc)  
  zip.extractall("/data/census/states/") #unzip!

```

---

  # The Shapefile 
  #### What's with all these files? 

* .shp—The main file that stores the feature geometry; required.

* .shx—The index file that stores the index of the feature geometry; required.

* .dbf—The dBASE table that stores the attribute information of features; required. There is a one-to-one relationship between geometry and attributes, which is based on record number. Attribute records in the dBASE file must be in the same order as records in the main file.

* .sbn and .sbx—The files that store the spatial index of the features.

* .prj—The file that stores the coordinate system information; used by ArcGIS.

* .xml—Metadata for ArcGIS—stores information about the shapefile.



---
  # The Shapefile 
  #### What's with all these files? 
optional files:

* .fbn and .fbx—The files that store the spatial index of the features for shapefiles that are read-only.

* .ain and .aih—The files that store the attribute index of the active fields in a table or a theme's attribute table.

* .atx—An .atx file is created for each shapefile or dBASE attribute index created in ArcCatalog. ArcView GIS 3.x attribute indexes for shapefiles and dBASE files are not used by ArcGIS. A new attribute indexing model has been developed for shapefiles and dBASE files.

* .ixs—Geocoding index for read/write shapefiles.

* .cpg—An optional file that can be used to specify the codepage for identifying 

* .mxs—Geocoding index for read/write shapefiles (ODB format).

---

</br>
</br>
</br>
</br>
</br>
</br>
</br>
</br>
</br>
#[IPython Notebook: The Setup and Download and Unzip a Shapefile](http://nbviewer.ipython.org/github/stat4701-edav-d3/d3-presentation/blob/master/00-d3-presentation.ipynb#The-Setup)


---

.left-column[
  #Conversion
]

.right-column[
  ##GDAL/OGR
  Now that we have our Shapefile, we need to convert it into JSON in order to use it in web applications. This is a two-step process -- we will convert .shp into GeoJSON and then convert GeoJSON into Topojson using a few nifty tools. 

  ##.shp to GeoJSON
  For this first step, we're going to use [GDAL/OGR](http://www.gdal.org/). GDAL/OGR can be installed using ```sudo apt-get install gdal-bin``` 
  or, for all you OSX folks, ```brew install gdal```.

  </br>

  Next, using the ```ogr2ogr``` commands, we can convert the Shapefile to JSON:

</br>

    ogr2ogr -f GeoJSON states.json cb_2013_us_state_20m.shp
</br>
</br>
</br>
</br>
</br>
</br>
]

---
.left-column[
  #Conversion
]
.right-column[
  ##GDAL/OGR

  ### GeoJSON to TopoJSON

 For the next step, we need to install topojson. Before doing this though, you need to make sure youhave [node.js](http://nodejs.org/download/) installed.
</br>
</br>
</br>
</br>

 Using the command ```sudo npm install -g topojson```  or ```npm install -g topojson``` (OSX) will then install topojson. We can then create our TopoJson:
</br>
</br>
</br>
</br>

    
    topojson states.topo.json states.json
]

---
</br>
</br>
</br>
</br>
</br>
</br>
###Another Option, as you may want to modify and tweak the Simplification algorithm of the TopoJson file, is...
#MapShaper


* ##[MapShaper](http://www.mapshaper.org/)

* ##Demo MapShaper with Census Shapefile on Desktop

---

.left-column[
  #Plotting in D3
]
.right-column[
</br>

  ###[The TopoJSON file in a simple plot](http://stat4701-edav-d3.github.io/viz/plot_json_1.html)
</br>
</br>
</br>
</br>
</br>
</br>
 [![plot json](https://raw.githubusercontent.com/stat4701-edav-d3/d3-presentation/master/img/plot_json.png)](http://stat4701-edav-d3.github.io/viz/plot_json_1.html)  

###[Here’s the HTML code](https://github.com/stat4701-edav-d3/stat4701-edav-d3.github.com/blob/master/viz/plot_json_1.html)


]
---

</br>
</br>
</br>
</br>
##That's enough to make you want to install a local instance of cold beer.

![cold beer](https://camo.githubusercontent.com/9dd59c598e38baf943174ad4cb2d334401ba8a34/687474703a2f2f746865736f636965747970616765732e6f72672f736f63696d616765732f66696c65732f323031302f30382f70616273742d626c75652d726962626f6e2e6a7067)

However, that is hardly a presentable map...

---

.left-column[
  #Plotting the JSON in D3
]
.right-column[
  

  #Reconfiguring the Map Extents

  [The Map with new Extents](http://stat4701-edav-d3.github.io/viz/plot_json_2.html)
  
  [Here’s the HTML code - Project ](https://github.com/stat4701-edav-d3/stat4701-edav-d3.github.com/blob/master/viz/plot_json_2.html)

  [Geoprocessing](http://nbviewer.ipython.org/github/stat4701-edav-d3/d3-presentation/blob/master/02-shape-joins-and-convert-to-json.ipynb)
]

---

.left-column[
  # TopoJSON vs. GeoJSON
]
.right-column[
![Size compression for country data](http://commondatastorage.googleapis.com/imgserv%2Ffilesize.png)
]

---

.left-column[
  # Demo: Choropleth
]

[Link to Choropleth](http://stat4701-edav-d3.github.io/viz/choropleth/choropleth.html)



---

.left-column[
  # Demo: Interactive Map (Tom Noda)
]

[Check It!](http://stat4701-edav-d3.github.io/tnoda/index.html)


---

.left-column[
  # Demo: Google Flu Data Map
]

.right-column[


  The vaccine for the 2014-2015 flu season has only been [18% effective](http://www.nlm.nih.gov/medlineplus/news/fullstory_151174.html) against the dominant strain (H3N2) of the flu. 
  There have already been some great visualizations of flu data including the Washington Post's weekly [flu tracker](http://www.washingtonpost.com/graphics/health/flu-tracker/):

  ![WaPo Flu](https://raw.githubusercontent.com/stat4701-edav-d3/stat4701-edav-d3.github.com/master/remark-develop/wapo.jpg)

  
]
---

.left-column[
  # Demo: Google Flu Data Map
]

.right-column[


  The vaccine for the 2014-2015 flu season has only been [18% effective](http://www.nlm.nih.gov/medlineplus/news/fullstory_151174.html) against the dominant strain (H3N2) of the flu. 
  There have already been some great visualizations of flu data including the Washington Post's weekly [flu tracker](http://www.washingtonpost.com/graphics/health/flu-tracker/).

  We decided to try and use a similar concept and visualize monthly changes over time:


  ## Finding the Data:

  ### [CDC Flu Activity and Surveillance](http://www.cdc.gov/flu/weekly/fluactivitysurv.htm)

  ### [Google Flu Trends](https://www.google.org/flutrends/us/#US)

]
---

.left-column[
  # Demo: Google Flu Data Map
]

.right-column[


  The vaccine for the 2014-2015 flu season has only been [18% effective](http://www.nlm.nih.gov/medlineplus/news/fullstory_151174.html) against the dominant strain (H3N2) of the flu. 
  There have already been some great visualizations of flu data including the Washington Post's weekly [flu tracker](http://www.washingtonpost.com/graphics/health/flu-tracker/).

  We decided to try and use a similar concept and visualize monthly changes over time:


  ## Munging the Data:

  ### [In Notebook: EDA](http://nbviewer.ipython.org/github/stat4701-edav-d3/d3-presentation/blob/master/01-read-in-source-data-for-all-sources.ipynb)

  ### [Cities Lat/Longs](https://raw.githubusercontent.com/stat4701-edav-d3/stat4701-edav-d3.github.com/master/remark-develop/img/seeing-latlngs-in-source-from-google-trends.png)

]
---


.left-column[
  # Demo: Google Flu Data Map
]

.right-column[


  The vaccine for the 2014-2015 flu season has only been [18% effective](http://www.nlm.nih.gov/medlineplus/news/fullstory_151174.html) against the dominant strain (H3N2) of the flu. 
  There have already been some great visualizations of flu data including the Washington Post's weekly [flu tracker](http://www.washingtonpost.com/graphics/health/flu-tracker/).

  We decided to try and use a similar concept and visualize monthly changes over time:

  ## Visualizing the Data

  ### [Check It OUt:](http://stat4701-edav-d3.github.io/viz/cities/cities.html)
]
---


[GDAL/OGR](http://nbviewer.ipython.org/github/stat4701-edav-d3/d3-presentation/blob/master/01-read-in-source-data-for-all-sources.ipynb#GDAL/OGR)



---


    </textarea>
    <script src="http://gnab.github.io/remark/downloads/remark-0.5.9.min.js" type="text/javascript">
    </script>
    <script type="text/javascript">
      var slideshow = remark.create();
    </script>
  </body>
</html>
